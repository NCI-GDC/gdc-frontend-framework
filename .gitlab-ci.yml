# To contribute improvements to CI/CD templates, please follow the Development guide at:
# https://docs.gitlab.com/ee/development/cicd/templates.html

include:
  - project: nci-gdc/gitlab-templates
    ref: master
    file:
      - templates/global/full.yaml

image: docker.osdc.io/node:16
variables:
  npm_config_registry: https://nexus.osdc.io/repository/npm-all/


build:
  stage: build
  services:
    - docker:20.10.16-dind
  tags:
    - dind
  image: docker:20.10.16-dind
  variables:
    npm_config_registry: https://nexus.osdc.io/repository/npm-all/
  script:
    - BRANCH="${CI_COMMIT_BRANCH//[\/]/_}"
    - docker build -t $REGISTRY/$CI_PROJECT_NAME:$BRANCH .
    - docker push $REGISTRY/$CI_PROJECT_NAME:$BRANCH
